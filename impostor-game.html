<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ğŸ•µï¸â€â™‚ï¸ IMPOSTOR GAME</title>
<style>
body { 
  font-family: 'Segoe UI', sans-serif; 
  background: #0d1117; 
  color: #fff; 
  text-align: center; 
  margin: 0; 
  padding: 0; 
}

/* WiÄ™kszy tytuÅ‚ i emoji */
h1 { 
  color: #00d26a; 
  margin-top: 40px; 
  font-size: 42px; 
}

/* Przyciski */
button { 
  background: #00d26a; 
  color: black; 
  border: none; 
  border-radius: 12px; 
  padding: 20px 40px; 
  font-size: 20px; 
  margin: 15px 0; 
  cursor: pointer; 
  width: 80%; 
  max-width: 300px; 
}
button:hover { 
  background: #00b85d; 
}

/* Pola tekstowe */
input { 
  font-size: 20px; 
  padding: 15px; 
  border-radius: 10px; 
  border: 1px solid #ccc; 
  width: 80%; 
  max-width: 300px; 
  text-align: center; 
  margin-bottom: 15px; 
}

/* Panel gracza z lekkim efektem Å›wiecenia */
#myName {
  margin-top: 20px;
  padding: 20px;
  background: #1c222b;
  border-radius: 15px;
  box-shadow: 0 0 15px rgba(0, 210, 106, 0.4);
  font-size: 20px;
  display: inline-block;
}

/* Karta z hasÅ‚em â€” wyrÃ³Å¼niona */
.card { 
  margin-top: 30px; 
  padding: 25px 30px; 
  background: #161b22; 
  border-radius: 20px; 
  display: inline-block; 
  font-size: 26px; 
  font-weight: bold; 
  color: #00d26a;
  text-shadow: 0 0 8px rgba(0, 210, 106, 0.7);
  max-width: 90%; 
  word-wrap: break-word; 
  transition: all 0.3s ease;
}

.hidden { display: none; }
</style>
</head>
<body>

<h1 id="title">ğŸ•µï¸â€â™‚ï¸ IMPOSTOR GAME</h1>

<!-- WYBÃ“R JÄ˜ZYKA -->
<div style="margin-bottom:20px;">
  <button id="btnLangPl">ğŸ‡µğŸ‡± Polski</button>
  <button id="btnLangDe">ğŸ‡©ğŸ‡ª Deutsch</button>
</div>

<div id="menu">
  <input id="playerName" placeholder="Twoje imiÄ™" />
  <button id="btnCreate">StwÃ³rz grÄ™</button>
  <p id="orText" style="margin:10px 0;">lub</p>
  <input id="joinCode" placeholder="Kod pokoju" />
  <button id="btnJoin">DoÅ‚Ä…cz</button>
</div>

<div id="hostPanel" class="hidden">
  <h2><span id="roomCodeLabel">Kod pokoju:</span> <span id="roomCode"></span></h2>
  <p id="players">Gracze: 0/7</p>
  <p id="playerList"></p>
  <button id="btnStart">Rozdaj role</button>
  <button id="btnNextRound" class="hidden">Rozlosuj kolejnÄ… rundÄ™</button>
</div>

<div id="waiting" class="hidden">
  <h2 id="waitingText">Oczekiwanie na rozpoczÄ™cie...</h2>
</div>

<div id="myName" class="hidden card"></div>
<div id="result" class="hidden card"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAy1mE_Q3fJo9W2Aa9EQUqp0L0Bn53XPHc",
  authDomain: "impostor-game-ebc12.firebaseapp.com",
  databaseURL: "https://impostor-game-ebc12-default-rtdb.europe-west1.firebasedatabase.app/",
  projectId: "impostor-game-ebc12",
  storageBucket: "impostor-game-ebc12.appspot.com",
  messagingSenderId: "561452405867",
  appId: "1:561452405867:web:24fb4cdf0320c2c3488d2e",
  measurementId: "G-DKBLTBFHJ5"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const words = ["OKO","DARMOZJAD","TIKTOK","MEM","NETFLIX","LODY","ROWER","Å»ABKA","CARPATH","AGRECOL","PIZZA","PASTA","STARUCH","SIGMA","SNAP","DISCORD","SZKOÅA","TRAMWAJ","WAKACJE","PARK","KOT","PIES","IPHONE","KOMPUTER","FRYZURA","EMOJI","POLICJA","BAN","FLEX","KANAPKA","DÅUGOPIS","KAKTUS","DRIP","DOMÃ“WKA","HERBATA","MIÅOÅšÄ†","GRA","FILM","SPORT","PRALKA","SUSHI","TEAM","FACEBOOK","YOUTUBE","POCIÄ„G","DOM","BUDYNEK","BRAMKA"];

let playerId = Math.random().toString(36).substring(2,9);
let roomRef = null;
let isHost = false;
let playerName = "";

/* ========= TÅUMACZENIA PL/DE ========= */
let lang = "pl";
const t = {
  pl: {
    title: "ğŸ•µï¸â€â™‚ï¸ IMPOSTOR GAME",
    yourName: "Twoje imiÄ™",
    create: "StwÃ³rz grÄ™",
    or: "lub",
    joinCode: "Kod pokoju",
    join: "DoÅ‚Ä…cz",
    roomCode: "Kod pokoju:",
    players: "Gracze",
    dealRoles: "Rozdaj role",
    nextRound: "Rozlosuj kolejnÄ… rundÄ™",
    waiting: "Oczekiwanie na rozpoczÄ™cie...",
    guess: "ZGADNIJ IMPOSTORA",
    enterName: "Podaj imiÄ™!",
    enterRoom: "Podaj kod pokoju!",
    noRoom: "PokÃ³j nie istnieje!",
    need7: "Musi byÄ‡ dokÅ‚adnie 7 graczy (bez hosta)!",
    impostor: "ğŸ•µï¸â€â™‚ï¸ JESTEÅš IMPOSTOREM!",
    word: "ğŸ”¤ HasÅ‚o",
    roundStarted: "Runda rozpoczÄ™ta!"
  },
  de: {
    title: "ğŸ•µï¸â€â™‚ï¸ IMPOSTOR SPIEL",
    yourName: "Dein Name",
    create: "Spiel erstellen",
    or: "oder",
    joinCode: "Raumcode",
    join: "Beitreten",
    roomCode: "Raumcode:",
    players: "Spieler",
    dealRoles: "Rollen verteilen",
    nextRound: "NÃ¤chste Runde auslosen",
    waiting: "Warten auf den Start...",
    guess: "FINDE DEN IMPOSTOR",
    enterName: "Gib einen Namen ein!",
    enterRoom: "Gib den Raumcode ein!",
    noRoom: "Raum existiert nicht!",
    need7: "Es mÃ¼ssen genau 7 Spieler sein (ohne Host)!",
    impostor: "ğŸ•µï¸â€â™‚ï¸ DU BIST DER IMPOSTOR!",
    word: "ğŸ”¤ Wort",
    roundStarted: "Runde gestartet!"
  }
};

function applyLang() {
  document.getElementById("title").innerText = t[lang].title;
  document.getElementById("playerName").placeholder = t[lang].yourName;
  document.getElementById("btnCreate").innerText = t[lang].create;
  document.getElementById("orText").innerText = t[lang].or;
  document.getElementById("joinCode").placeholder = t[lang].joinCode;
  document.getElementById("btnJoin").innerText = t[lang].join;
  document.getElementById("roomCodeLabel").innerText = t[lang].roomCode;
  document.getElementById("btnStart").innerText = t[lang].dealRoles;
  document.getElementById("btnNextRound").innerText = t[lang].nextRound;
  document.getElementById("waitingText").innerText = t[lang].waiting;
}
applyLang();
/* ==================================== */

function randomCode() { return Math.floor(1000 + Math.random() * 9000).toString(); }

function showMyName() {
  const nameDiv = document.getElementById("myName");
  nameDiv.innerText = `Twoje imiÄ™: ${playerName}`;
  nameDiv.classList.remove("hidden");
}

function showResult(text) {
  document.getElementById("result").innerText = text;
  document.getElementById("result").classList.remove("hidden");

  const waitingDiv = document.getElementById("waiting");
  if (!waitingDiv.classList.contains("hidden")) {
    waitingDiv.querySelector("h2").innerText = t[lang].guess;
  }
}

async function updatePlayerList() {
  const snap = await roomRef.get();
  const data = snap.val();
  const playersList = data.players ? Object.values(data.players).map(p => p.name) : [];
  document.getElementById("playerList").innerText = playersList.join(", ");
  const nonHostCount = playersList.filter(n => !n.includes("(HOST)")).length;
  document.getElementById("players").innerText = `${t[lang].players}: ${nonHostCount}/7`;
}

// Tworzenie pokoju
window.createRoom = async function() {
  playerName = document.getElementById("playerName").value.trim();
  if (!playerName) return alert(t[lang].enterName);
  playerName += " (HOST)";
  isHost = true;
  showMyName();

  const code = randomCode();
  roomRef = db.ref("rooms/" + code);
  await roomRef.set({ players: {}, started: false });

  document.getElementById("menu").classList.add("hidden");
  document.getElementById("hostPanel").classList.remove("hidden");
  document.getElementById("roomCode").innerText = code;

  const playerRef = db.ref(`rooms/${code}/players/${playerId}`);
  await playerRef.set({ name: playerName });

  roomRef.on("value", async snapshot => {
    await updatePlayerList();
    const data = snapshot.val();
    if (data.started && data.roles && data.word) {
      const role = data.roles[playerId];
      if (role === "impostor") showResult(t[lang].impostor);
      else if (role !== "host") showResult(`${t[lang].word}: ${data.word}`);
    }
  });
}

// DoÅ‚Ä…czenie do pokoju
window.joinRoom = async function() {
  playerName = document.getElementById("playerName").value.trim();
  if (!playerName) return alert(t[lang].enterName);
  showMyName();

  const code = document.getElementById("joinCode").value.trim();
  if (!code) return alert(t[lang].enterRoom);
  roomRef = db.ref("rooms/" + code);

  roomRef.get().then(async snapshot => {
    if (!snapshot.exists()) return alert(t[lang].noRoom);

    const playerRef = db.ref(`rooms/${code}/players/${playerId}`);
    playerRef.set({ name: playerName });

    document.getElementById("menu").classList.add("hidden");
    document.getElementById("waiting").classList.remove("hidden");

    roomRef.on("value", snapshot => {
      updatePlayerList();
      const data = snapshot.val();
      if (data.started && data.roles && data.word) {
        const role = data.roles[playerId];
        if (role === "impostor") showResult(t[lang].impostor);
        else if (role !== "host") showResult(`${t[lang].word}: ${data.word}`);
      }
    });
  });
}

// RozpoczÄ™cie gry (host)
window.startGame = async function() {
  const snap = await roomRef.get();
  const data = snap.val();
  const players = Object.keys(data.players || {}).filter(id => !data.players[id].name.includes("(HOST)"));

  // âœ… POPRAWKA: musi byÄ‡ 7 (bez hosta)
  if (players.length !== 7) return alert(t[lang].need7);

  const word = words[Math.floor(Math.random() * words.length)];
  const impostor = players[Math.floor(Math.random() * players.length)];
  const roles = {};
  players.forEach(p => roles[p] = p === impostor ? "impostor" : "normal");
  roles[playerId] = "host";

  await roomRef.update({ started: true, roles, word });
  document.getElementById("btnNextRound").classList.remove("hidden");
  showResult(t[lang].roundStarted);
}

// Rozlosowanie kolejnej rundy (host)
window.nextRound = async function() {
  const snap = await roomRef.get();
  const data = snap.val();
  const players = Object.keys(data.players || {}).filter(id => !data.players[id].name.includes("(HOST)"));

  const word = words[Math.floor(Math.random() * words.length)];
  const impostor = players[Math.floor(Math.random() * players.length)];
  const roles = {};
  players.forEach(p => roles[p] = p === impostor ? "impostor" : "normal");
  roles[playerId] = "host";

  await roomRef.update({ started: true, roles, word });
  document.getElementById("result").classList.add("hidden");
}

/* Przyciski */
document.getElementById("btnCreate").addEventListener("click", createRoom);
document.getElementById("btnJoin").addEventListener("click", joinRoom);
document.getElementById("btnStart").addEventListener("click", startGame);
document.getElementById("btnNextRound").addEventListener("click", nextRound);

/* Zmiana jÄ™zyka */
document.getElementById("btnLangPl").addEventListener("click", () => { lang = "pl"; applyLang(); updatePlayerList(); });
document.getElementById("btnLangDe").addEventListener("click", () => { lang = "de"; applyLang(); updatePlayerList(); });
</script>
</body>
</html>
