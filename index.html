<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>üïµÔ∏è‚Äç‚ôÇÔ∏è IMPOSTOR GAME</title>
<style>
body { font-family: 'Segoe UI', sans-serif; background: #0d1117; color: #fff; text-align: center; margin: 0; padding: 0; }
h1 { color: #00d26a; margin-top: 40px; font-size: 42px; }
button { background: #00d26a; color: black; border: none; border-radius: 12px; padding: 15px 30px; font-size: 18px; margin: 10px; cursor: pointer; }
button:hover { background: #00b85d; }
input { font-size: 18px; padding: 12px; border-radius: 10px; border: 1px solid #ccc; width: 80%; max-width: 300px; text-align: center; margin-bottom: 15px; }
.hidden { display: none; }
.card { margin-top: 25px; padding: 25px; background: #161b22; border-radius: 20px; display: inline-block; font-size: 22px; color: #00d26a; text-shadow: 0 0 8px rgba(0,210,106,0.6); }
#votePanel { margin-top: 20px; background: #1c222b; border-radius: 15px; padding: 20px; }
#voteButtons button { display: block; width: 80%; max-width: 300px; margin: 10px auto; }
#impostorGuessPanel input { width: 180px; margin-right: 10px; }
</style>
</head>
<body>
<h1>üïµÔ∏è‚Äç‚ôÇÔ∏è IMPOSTOR GAME</h1>

<div id="menu">
  <input id="playerName" placeholder="Twoje imiƒô" />
  <button id="btnCreate">Stw√≥rz grƒô</button>
  <p>lub</p>
  <input id="joinCode" placeholder="Kod pokoju" />
  <button id="btnJoin">Do≈ÇƒÖcz</button>
</div>

<div id="hostPanel" class="hidden">
  <h2>Kod pokoju: <span id="roomCode"></span></h2>
  <p id="players">Gracze: 0/4</p>
  <p id="playerList"></p>
  <button id="btnStart">Rozdaj role</button>
</div>

<div id="waiting" class="hidden">
  <h2>Oczekiwanie na rozpoczƒôcie...</h2>
</div>

<div id="myName" class="hidden card"></div>
<div id="result" class="hidden card"></div>

<div id="votePanel" class="hidden card">
  <h3>Wybierz gracza, kt√≥rego podejrzewasz:</h3>
  <div id="voteButtons"></div>
  <div id="voteConfirm" class="hidden">
    <p id="selectedName"></p>
    <button id="btnConfirmVote">POTWIERD≈π WYB√ìR</button>
    <button id="btnCancelVote">COFNIJ</button>
  </div>
</div>

<div id="impostorGuessPanel" class="hidden card">
  <h3>Wpisz has≈Ço, aby zako≈Ñczyƒá rundƒô:</h3>
  <input id="impostorWord" placeholder="Has≈Ço" />
  <button id="submitWord">ZATWIERD≈π</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAy1mE_Q3fJo9W2Aa9EQUqp0L0Bn53XPHc",
  authDomain: "impostor-game-ebc12.firebaseapp.com",
  databaseURL: "https://impostor-game-ebc12-default-rtdb.europe-west1.firebasedatabase.app/",
  projectId: "impostor-game-ebc12",
  storageBucket: "impostor-game-ebc12.appspot.com",
  messagingSenderId: "561452405867",
  appId: "1:561452405867:web:24fb4cdf0320c2c3488d2e"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const words = ["ASTRONAUTA","PARAPET","KANIBAL","BETONIARKA","HIPOPOTAM","≈ªAGL√ìWKA","MAGNES","LAWENDA","≈ªYRANDOL","≈ª√ì≈ÅW","PIORUN","ROWERZYSTA","KOSMITA","SUSHI","MI≈ÅO≈öƒÜ","FILM","SPORT","POLICJA","DOM","PIES","KOT","TRAMWAJ","FOTOGRAF","PIANINO"];
let playerId = Math.random().toString(36).substring(2,9);
let roomRef = null;
let playerName = "";
let isHost = false;
let hasVoted = false;
let selectedVote = null;

function randomCode(){return Math.floor(1000+Math.random()*9000).toString();}
function showMyName(){const div=document.getElementById("myName");div.innerText="Twoje imiƒô: "+playerName;div.classList.remove("hidden");}
function showResult(text){const r=document.getElementById("result");r.innerText=text;r.classList.remove("hidden");}
function hideResult(){document.getElementById("result").classList.add("hidden");}

async function updatePlayerList(){
  const snap=await roomRef.get();const data=snap.val();
  const players=Object.values(data.players||{}).map(p=>p.name);
  document.getElementById("playerList").innerText=players.join(", ");
  document.getElementById("players").innerText=`Gracze: ${players.filter(p=>!p.includes("(HOST)")).length}/4`;
}

// Tworzenie pokoju
window.createRoom=async function(){
  playerName=document.getElementById("playerName").value.trim();
  if(!playerName)return alert("Podaj imiƒô!");
  playerName+=" (HOST)";
  isHost=true;
  const code=randomCode();
  roomRef=db.ref("rooms/"+code);
  await roomRef.set({players:{},started:false});
  await db.ref(`rooms/${code}/players/${playerId}`).set({name:playerName});
  document.getElementById("menu").classList.add("hidden");
  document.getElementById("hostPanel").classList.remove("hidden");
  document.getElementById("roomCode").innerText=code;
  showMyName();
  roomRef.on("value",snap=>{updatePlayerList();});
}

// Do≈ÇƒÖczenie
window.joinRoom=async function(){
  playerName=document.getElementById("playerName").value.trim();
  if(!playerName)return alert("Podaj imiƒô!");
  const code=document.getElementById("joinCode").value.trim();
  roomRef=db.ref("rooms/"+code);
  const s=await roomRef.get();if(!s.exists())return alert("Pok√≥j nie istnieje!");
  await db.ref(`rooms/${code}/players/${playerId}`).set({name:playerName});
  document.getElementById("menu").classList.add("hidden");
  document.getElementById("waiting").classList.remove("hidden");
  showMyName();
  roomRef.on("value",snap=>{
    const data=snap.val();updatePlayerList();
    if(data.started&&data.roles&&data.word)handleGameData(data);
    if(data.roundEnded)endRound(data);
  });
}

// Start gry (host)
window.startGame=async function(){
  hideResult();hasVoted=false;selectedVote=null;
  const s=await roomRef.get();const data=s.val();
  const players=Object.keys(data.players).filter(id=>!data.players[id].name.includes("(HOST)"));
  if(players.length<3)return alert("Potrzebujesz co najmniej 3 graczy!");
  const word=words[Math.floor(Math.random()*words.length)];
  const impostor=players[Math.floor(Math.random()*players.length)];
  const roles={};players.forEach(p=>roles[p]=(p===impostor)?"impostor":"normal");
  roles[playerId]="host";
  await roomRef.update({started:true,roles,word,votes:{},roundEnded:false,impostorWin:false});
  showResult("Runda rozpoczƒôta!");
}

// Logika gry
function handleGameData(data){
  const role=data.roles[playerId];
  hideResult();
  document.getElementById("votePanel").classList.add("hidden");
  document.getElementById("impostorGuessPanel").classList.add("hidden");
  if(role==="host"){showResult("üëë Jeste≈õ hostem.");return;}
  if(role==="impostor"){
    showResult("üïµÔ∏è‚Äç‚ôÇÔ∏è JESTE≈ö IMPOSTOREM!");
    document.getElementById("impostorGuessPanel").classList.remove("hidden");
    return;
  }
  showResult("üî§ Has≈Ço: "+data.word);
  const allPlayers=Object.entries(data.players)
    .filter(([id,p])=>!p.name.includes("(HOST)") && data.roles[id]!=="impostor" && p.name!==playerName)
    .map(([id,p])=>p.name);
  setTimeout(()=>showVotePanel(allPlayers),2000);
}

// Panel g≈Çosowania
function showVotePanel(players){
  const voteDiv=document.getElementById("voteButtons");
  const confirm=document.getElementById("voteConfirm");
  voteDiv.innerHTML="";confirm.classList.add("hidden");
  players.forEach(n=>{
    const b=document.createElement("button");
    b.textContent=n;b.onclick=()=>selectVote(n);
    voteDiv.appendChild(b);
  });
  document.getElementById("votePanel").classList.remove("hidden");
}

function selectVote(name){
  selectedVote=name;
  document.getElementById("selectedName").innerText="Tw√≥j wyb√≥r: "+name;
  document.getElementById("voteConfirm").classList.remove("hidden");
}

document.getElementById("btnCancelVote").onclick=function(){
  selectedVote=null;
  document.getElementById("voteConfirm").classList.add("hidden");
};

document.getElementById("btnConfirmVote").onclick=async function(){
  if(!selectedVote||hasVoted)return;
  hasVoted=true;
  const code=document.getElementById("roomCode").innerText||document.getElementById("joinCode").value;
  await db.ref(`rooms/${code}/votes/${playerId}`).set(selectedVote);
  document.getElementById("votePanel").innerHTML="<p>G≈Ços zapisany. Czekaj na innych...</p>";
  checkAllVoted();
};

async function checkAllVoted(){
  const s=await roomRef.get();const d=s.val();
  const eligible=Object.keys(d.roles).filter(id=>d.roles[id]!=="host"&&d.roles[id]!=="impostor");
  const votesCount=Object.keys(d.votes||{}).length;
  if(votesCount>=eligible.length){await roomRef.update({roundEnded:true});}
}

document.getElementById("submitWord").onclick=async function(){
  const val=document.getElementById("impostorWord").value.trim();
  const s=await roomRef.get();const d=s.val();
  if(val.toLowerCase()===d.word.toLowerCase()){
    await roomRef.update({roundEnded:true,impostorWin:true});
  } else alert("B≈Çƒôdne has≈Ço!");
};

// Zako≈Ñczenie rundy
function endRound(data){
  const impostorId=Object.keys(data.roles).find(id=>data.roles[id]==="impostor");
  const impostorName=data.players[impostorId].name;
  const votes=data.votes||{};
  const role=data.roles[playerId];

  document.getElementById("impostorGuessPanel").classList.add("hidden");
  document.getElementById("votePanel").classList.add("hidden");

  if(data.impostorWin){
    showResult("üïµÔ∏è‚Äç‚ôÇÔ∏è IMPOSTOR ODGAD≈Å HAS≈ÅO!");
    return;
  }

  if(role!=="host"){
    const myVote=votes[playerId];
    if(myVote===impostorName){showResult("üéâ GRATULACJE! Zgad≈Çe≈õ impostora! +1 punkt");}
    else{showResult("‚ùå POMY≈ÅKA! Ten gracz nie by≈Ç impostorem.");}
  } else {
    showResult("Runda zako≈Ñczona. Impostorem by≈Ç: "+impostorName);
  }
}

document.getElementById("btnCreate").onclick=createRoom;
document.getElementById("btnJoin").onclick=joinRoom;
document.getElementById("btnStart").onclick=startGame;
</script>
</body>
</html>
