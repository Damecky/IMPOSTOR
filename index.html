<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üïµÔ∏è‚Äç‚ôÇÔ∏è IMPOSTOR GAME</title>
<style>
body { font-family: 'Segoe UI', sans-serif; background: #0d1117; color: #fff; text-align: center; margin: 0; padding: 0; }
h1 { color: #00d26a; margin-top: 40px; font-size: 42px; }
button { background: #00d26a; color: black; border: none; border-radius: 12px; padding: 15px 30px; font-size: 18px; margin: 10px; cursor: pointer; }
button:hover { background: #00b85d; }
input { font-size: 18px; padding: 12px; border-radius: 10px; border: 1px solid #ccc; width: 80%; max-width: 300px; text-align: center; margin-bottom: 15px; }
.hidden { display: none; }
.card { margin-top: 25px; padding: 25px; background: #161b22; border-radius: 20px; display: inline-block; font-size: 22px; color: #00d26a; text-shadow: 0 0 8px rgba(0,210,106,0.6); }
#votePanel { margin-top: 20px; background: #1c222b; border-radius: 15px; padding: 20px; }
#voteButtons button { display: block; width: 80%; max-width: 300px; margin: 10px auto; }
</style>
</head>
<body>
<h1>üïµÔ∏è‚Äç‚ôÇÔ∏è IMPOSTOR GAME</h1>

<!-- MENU G≈Å√ìWNE -->
<div id="menu">
  <input id="playerName" placeholder="Twoje imiƒô" />
  <button id="btnCreate">Stw√≥rz grƒô</button>
  <p>lub</p>
  <input id="joinCode" placeholder="Kod pokoju" />
  <button id="btnJoin">Do≈ÇƒÖcz</button>
</div>

<!-- PANEL HOSTA -->
<div id="hostPanel" class="hidden">
  <h2>Kod pokoju: <span id="roomCode"></span></h2>
  <p id="players">Gracze: 0/6</p>
  <p id="playerList"></p>
  <button id="btnStart">Rozdaj role</button>
</div>

<!-- PANEL OCZEKIWANIA -->
<div id="waiting" class="hidden">
  <h2>Oczekiwanie na rozpoczƒôcie gry...</h2>
</div>

<!-- IMIƒò GRACZA -->
<div id="myName" class="hidden card"></div>

<!-- WYNIK / KOMUNIKAT -->
<div id="result" class="hidden card"></div>

<!-- PANEL G≈ÅOSOWANIA -->
<div id="votePanel" class="hidden card">
  <h3>Wybierz gracza, kt√≥rego podejrzewasz:</h3>
  <div id="voteButtons"></div>
  <div id="voteConfirm" class="hidden">
    <p id="selectedName"></p>
    <button id="btnConfirmVote">POTWIERD≈π WYB√ìR</button>
    <button id="btnCancelVote">COFNIJ</button>
  </div>
</div>

<!-- PANEL HAS≈ÅA (TYLKO DLA IMPOSTORA) -->
<div id="impostorGuessPanel" class="hidden card">
  <h3>Wpisz has≈Ço, aby zako≈Ñczyƒá rundƒô:</h3>
  <input id="impostorWord" placeholder="Has≈Ço" />
  <button id="submitWord">ZATWIERD≈π</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// üî• Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyAy1mE_Q3fJo9W2Aa9EQUqp0L0Bn53XPHc",
  authDomain: "impostor-game-ebc12.firebaseapp.com",
  databaseURL: "https://impostor-game-ebc12-default-rtdb.europe-west1.firebasedatabase.app/",
  projectId: "impostor-game-ebc12",
  storageBucket: "impostor-game-ebc12.appspot.com",
  messagingSenderId: "561452405867",
  appId: "1:561452405867:web:24fb4cdf0320c2c3488d2e"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// üîß Zmienne gry
const words = ["ASTRONAUTA","PARAPET","KANIBAL","BETONIARKA","HIPOPOTAM","≈ªAGL√ìWKA","MAGNES","LAWENDA","≈ªYRANDOL","≈ª√ì≈ÅW","PIORUN","ROWERZYSTA","KOSMITA","SUSHI","MI≈ÅO≈öƒÜ","FILM","SPORT","POLICJA","DOM","PIES","KOT","TRAMWAJ","FOTOGRAF","PIANINO"];
let playerId = Math.random().toString(36).substring(2,9);
let playerName = "";
let roomRef = null;
let isHost = false;
let hasVoted = false;
let selectedVote = null;

function randomCode(){return Math.floor(1000+Math.random()*9000).toString();}
function showMyName(){const d=document.getElementById("myName");d.innerText="Twoje imiƒô: "+playerName;d.classList.remove("hidden");}
function showResult(txt){const r=document.getElementById("result");r.innerText=txt;r.classList.remove("hidden");}
function hideResult(){document.getElementById("result").classList.add("hidden");}

// üîπ Ukryj wszystkie panele gry na starcie
document.getElementById("votePanel").classList.add("hidden");
document.getElementById("impostorGuessPanel").classList.add("hidden");
hideResult();

// üîπ Tworzenie pokoju
async function createRoom(){
  playerName=document.getElementById("playerName").value.trim();
  if(!playerName)return alert("Podaj imiƒô!");
  playerName+=" (HOST)";
  isHost=true;
  const code=randomCode();
  roomRef=db.ref("rooms/"+code);
  await roomRef.set({players:{},started:false});
  await db.ref(`rooms/${code}/players/${playerId}`).set({name:playerName});
  document.getElementById("menu").classList.add("hidden");
  document.getElementById("hostPanel").classList.remove("hidden");
  document.getElementById("roomCode").innerText=code;
  showMyName();
  roomRef.on("value",snap=>updatePlayerList(snap.val()));
}

// üîπ Do≈ÇƒÖczanie do pokoju
async function joinRoom(){
  playerName=document.getElementById("playerName").value.trim();
  if(!playerName)return alert("Podaj imiƒô!");
  const code=document.getElementById("joinCode").value.trim();
  roomRef=db.ref("rooms/"+code);
  const snap=await roomRef.get();
  if(!snap.exists())return alert("Pok√≥j nie istnieje!");
  await db.ref(`rooms/${code}/players/${playerId}`).set({name:playerName});
  document.getElementById("menu").classList.add("hidden");
  document.getElementById("waiting").classList.remove("hidden");
  showMyName();
  roomRef.on("value",snap=>{
    const data=snap.val();
    updatePlayerList(data);
    if(data.started && data.roles && data.word) handleGameData(data);
    if(data.roundEnded) endRound(data);
  });
}

function updatePlayerList(data){
  const list=Object.values(data.players||{}).map(p=>p.name);
  document.getElementById("playerList").innerText=list.join(", ");
  document.getElementById("players").innerText=`Gracze: ${list.filter(n=>!n.includes("(HOST)")).length}/6`;
}

// üîπ Obs≈Çuga danych gry po starcie
function handleGameData(data) {
  // Ukryj wszystko na start, ≈ºeby nie pojawia≈Ço siƒô niepotrzebnie
  document.getElementById("votePanel").classList.add("hidden");
  document.getElementById("impostorGuessPanel").classList.add("hidden");
  hideResult();

  // Sprawd≈∫, czy gracz ma przypisanƒÖ rolƒô
  const role = data.roles ? data.roles[playerId] : null;
  const word = data.word;

  if (!role) return; // jeszcze nie przydzielono r√≥l ‚Üí nie r√≥b nic

  // HOST
  if (role === "host") {
    showResult("üëë Jeste≈õ hostem. Czekaj na zako≈Ñczenie rundy.");
    return;
  }

  // IMPOSTOR
  if (role === "impostor") {
    showResult("üïµÔ∏è‚Äç‚ôÇÔ∏è JESTE≈ö IMPOSTOREM!");
    document.getElementById("impostorGuessPanel").classList.remove("hidden");
    return;
  }

  // ZWYK≈ÅY GRACZ
  if (role === "normal") {
    showResult(`üî§ Has≈Ço: ${word}`);
    const allPlayers = Object.entries(data.players)
      .filter(([id, p]) => !p.name.includes("(HOST)") && data.roles[id] !== "impostor" && id !== playerId)
      .map(([id, p]) => p.name);
    setTimeout(() => showVotePanel(allPlayers), 2000);
  }

  // Je≈õli runda ju≈º siƒô zako≈Ñczy≈Ça
  if (data.roundEnded) {
    endRound(data);
  }
}

// üîπ Zako≈Ñczenie rundy
function endRound(data) {
  document.getElementById("votePanel").classList.add("hidden");
  document.getElementById("impostorGuessPanel").classList.add("hidden");

  const impostorId = Object.keys(data.roles).find(id => data.roles[id] === "impostor");
  const impostorName = data.players[impostorId].name;
  const votes = data.votes || {};
  const role = data.roles[playerId];

  if (data.impostorWin) {
    showResult("üïµÔ∏è‚Äç‚ôÇÔ∏è IMPOSTOR ODGAD≈Å HAS≈ÅO!");
    return;
  }

  if (role !== "host") {
    const myVote = votes[playerId];
    if (myVote === impostorName) {
      showResult("üéâ GRATULACJE! Zgad≈Çe≈õ impostora!");
    } else {
      showResult("‚ùå POMY≈ÅKA! Ten gracz nie by≈Ç impostorem.");
    }
  } else {
    showResult("Runda zako≈Ñczona. Impostorem by≈Ç: " + impostorName);
  }
}

// üîπ Przypisanie przycisk√≥w
document.getElementById("btnCreate").onclick=createRoom;
document.getElementById("btnJoin").onclick=joinRoom;
document.getElementById("btnStart").onclick=startGame;
</script>
</body>
</html>


